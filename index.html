<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† LA PROGRAMMAZIONE DINAMICA - Piattaforma di Apprendimento Avanzata</title>
    
    <!-- Font Awesome per icone -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Prism.js per syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    
    <!-- Chart.js per visualizzazioni -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Pyodide per esecuzione Python nel browser -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    
    <!-- D3.js per visualizzazioni interattive -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --primary-dark: #3730a3;
            --secondary: #ec4899;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --dark: #f9fafb;
            --light: #1f2937;
            --gray: #9ca3af;
            background: #0f172a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #fdf6ff 0%, #f0f9ff 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.8;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1e1b4b 0%, #0f172a 100%);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Top Navigation Bar */
        .top-nav {
            background: white;
            padding: 15px 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        [data-theme="dark"] .top-nav {
            background: #1e293b;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Mode Buttons */
        .mode-selector {
            display: flex;
            gap: 10px;
            background: #f3f4f6;
            padding: 5px;
            border-radius: 8px;
        }

        [data-theme="dark"] .mode-selector {
            background: #0f172a;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .mode-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Theme Toggle */
        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: rotate(180deg);
        }

        /* Hero Header */
        .hero-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 60px 40px;
            border-radius: var(--border-radius);
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-30px, 30px) rotate(240deg); }
        }

        .hero-header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 250px 1fr 350px;
            gap: 30px;
            align-items: start;
        }

        /* Left Sidebar - Chapter Navigation */
        .chapter-sidebar {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            position: sticky;
            top: 20px;
        }

        [data-theme="dark"] .chapter-sidebar {
            background: #1e293b;
        }

        .chapter-list {
            list-style: none;
        }

        .chapter-item {
            margin-bottom: 10px;
        }

        .chapter-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            color: var(--dark);
            position: relative;
        }

        .chapter-link:hover {
            background: #f3f4f6;
            transform: translateX(5px);
        }

        [data-theme="dark"] .chapter-link:hover {
            background: #334155;
        }

        .chapter-link.active {
            background: var(--primary);
            color: white;
        }

        .chapter-link.completed::after {
            content: '‚úì';
            position: absolute;
            right: 15px;
            background: var(--success);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Content Area */
        .content-area {
            background: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        [data-theme="dark"] .content-area {
            background: #1e293b;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* Right Sidebar */
        .right-sidebar {
            position: sticky;
            top: 20px;
        }

        /* Spaced Repetition Dashboard */
        .spaced-repetition-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        [data-theme="dark"] .spaced-repetition-card {
            background: #1e293b;
        }

        .review-queue {
            margin-top: 15px;
        }

        .review-item {
            padding: 10px;
            background: #f3f4f6;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        [data-theme="dark"] .review-item {
            background: #334155;
        }

        .review-item:hover {
            background: #e5e7eb;
            transform: translateX(5px);
        }

        .review-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .stat-box {
            text-align: center;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 8px;
        }

        [data-theme="dark"] .stat-box {
            background: #0f172a;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Interactive Python Editor with Real Execution */
        .python-editor-advanced {
            background: #1e293b;
            border-radius: 12px;
            overflow: hidden;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .editor-header {
            background: #0f172a;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #334155;
        }

        .editor-title {
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .btn-run {
            background: var(--success);
            color: white;
        }

        .btn-run:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .btn-test {
            background: var(--info);
            color: white;
        }

        .btn-solution {
            background: var(--warning);
            color: white;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 400px;
        }

        .editor-pane {
            position: relative;
            overflow: hidden;
        }

        .editor-textarea {
            width: 100%;
            height: 100%;
            padding: 20px;
            background: #1e293b;
            color: #e2e8f0;
            border: none;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
        }

        .test-results {
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            overflow-y: auto;
            border-left: 1px solid #334155;
        }

        .test-case {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
        }

        .test-case.passed {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--success);
        }

        .test-case.failed {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--danger);
        }

        /* Interactive Visualizations */
        .dp-visualizer {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            position: relative;
        }

        [data-theme="dark"] .dp-visualizer {
            background: #0f172a;
            border-color: #334155;
        }

        .vis-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .vis-canvas {
            min-height: 300px;
            position: relative;
        }

        /* Auto-explanation Fields */
        .explanation-box {
            background: #f3f4f6;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        [data-theme="dark"] .explanation-box {
            background: #0f172a;
        }

        .explanation-prompt {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .explanation-field {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
        }

        [data-theme="dark"] .explanation-field {
            background: #1e293b;
            border-color: #334155;
            color: white;
        }

        /* Worked Examples */
        .worked-example {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }

        [data-theme="dark"] .worked-example {
            background: #0f172a;
            border-color: #334155;
        }

        .example-steps {
            margin-top: 20px;
        }

        .example-step {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .example-step {
            background: #1e293b;
            border-color: #334155;
        }

        .step-hidden {
            filter: blur(5px);
            user-select: none;
            cursor: pointer;
        }

        .step-reveal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Metacognitive Dashboard */
        .metacognitive-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .meta-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] .meta-card {
            background: #1e293b;
        }

        .heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            margin-top: 15px;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }

        .heatmap-cell:hover {
            transform: scale(1.2);
        }

        /* Difficulty Adaptive System */
        .difficulty-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .difficulty-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .difficulty-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
            transition: width 0.5s ease;
        }

        /* Focus Mode */
        .focus-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(79, 70, 229, 0.3);
            transition: var(--transition);
            z-index: 1000;
        }

        .focus-mode-toggle:hover {
            transform: scale(1.1);
        }

        body.focus-mode .chapter-sidebar,
        body.focus-mode .right-sidebar,
        body.focus-mode .top-nav {
            display: none;
        }

        body.focus-mode .main-layout {
            grid-template-columns: 1fr;
        }

        body.focus-mode .content-area {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Keyboard Shortcuts Modal */
        .shortcuts-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            max-width: 500px;
            width: 90%;
        }

        [data-theme="dark"] .shortcuts-modal {
            background: #1e293b;
        }

        .shortcuts-modal.show {
            display: block;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .shortcut-key {
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
        }

        [data-theme="dark"] .shortcut-key {
            background: #0f172a;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 250px 1fr;
            }
            
            .right-sidebar {
                display: none;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .chapter-sidebar {
                position: static;
                margin-bottom: 20px;
            }
            
            .editor-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .test-results {
                border-left: none;
                border-top: 1px solid #334155;
                height: 200px;
            }
        }

        @media (max-width: 768px) {
            .hero-header h1 {
                font-size: 2rem;
            }
            
            .top-nav {
                flex-direction: column;
                gap: 15px;
            }
            
            .metacognitive-dashboard {
                grid-template-columns: 1fr;
            }
            
            .content-area {
                padding: 20px;
            }
        }

        /* Chapter Content Base Styles */
        .chapter-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .chapter-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chapter-content h2 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--primary-light);
            padding-bottom: 15px;
        }

        .chapter-content h3 {
            color: var(--primary-dark);
            font-size: 1.8rem;
            margin: 30px 0 20px;
        }

        /* Special Content Boxes */
        .insight-box {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            border-left: 4px solid var(--primary);
            padding: 20px 25px;
            margin: 25px 0;
            border-radius: 8px;
            position: relative;
        }

        [data-theme="dark"] .insight-box {
            background: linear-gradient(135deg, #312e81 0%, #1e1b4b 100%);
        }

        .question-box {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 20px 25px;
            margin: 25px 0;
            border-radius: 8px;
            position: relative;
        }

        [data-theme="dark"] .question-box {
            background: #78350f;
        }

        /* Active Recall Components */
        .recall-exercise {
            background: #f0f9ff;
            border: 2px solid #0891b2;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }

        [data-theme="dark"] .recall-exercise {
            background: #0c4a6e;
            border-color: #0891b2;
        }

        .recall-prompt {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .recall-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        [data-theme="dark"] .recall-input {
            background: #1e293b;
            border-color: #334155;
            color: white;
        }

        /* Code Diff Viewer */
        .diff-viewer {
            background: #1e293b;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .diff-line {
            padding: 2px 10px;
            margin: 2px 0;
            border-radius: 3px;
        }

        .diff-added {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .diff-removed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .diff-unchanged {
            color: #94a3b8;
        }

        /* Interleaving Practice Mode */
        .practice-mode-selector {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        [data-theme="dark"] .practice-mode-selector {
            background: #1e293b;
        }

        .practice-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .practice-option {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        [data-theme="dark"] .practice-option {
            border-color: #334155;
        }

        .practice-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .practice-option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Achievement System Enhanced */
        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
            max-width: 350px;
        }

        [data-theme="dark"] .achievement-popup {
            background: #1e293b;
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        /* ASCII Art Styling */
        .ascii-art {
            background: #2d3748;
            color: #48bb78;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.3;
            margin: 20px 0;
            overflow-x: auto;
            white-space: pre;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] .ascii-art {
            background: #0f172a;
        }

        /* Interactive Quiz Enhanced */
        .quiz-container {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }

        [data-theme="dark"] .quiz-container {
            background: #0f172a;
            border-color: #334155;
        }

        .quiz-question {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .quiz-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--warning);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        /* Notification System */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            z-index: 1500;
        }

        [data-theme="dark"] .notification {
            background: #1e293b;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--info);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Caricamento ambiente Python...</h3>
            <p>Preparazione dell'esperienza di apprendimento interattiva</p>
        </div>
    </div>

    <div class="container">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-left">
                <h3 style="margin: 0;">üß† Programmazione Dinamica</h3>
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="setMode('learn')">
                        <i class="fas fa-book"></i> Apprendi
                    </button>
                    <button class="mode-btn" onclick="setMode('practice')">
                        <i class="fas fa-dumbbell"></i> Pratica
                    </button>
                    <button class="mode-btn" onclick="setMode('review')">
                        <i class="fas fa-history"></i> Ripasso
                    </button>
                </div>
            </div>
            <div class="nav-right">
                <button class="btn btn-info" onclick="showShortcuts()">
                    <i class="fas fa-keyboard"></i> Shortcuts
                </button>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </nav>

        <!-- Hero Header -->
        <header class="hero-header" id="heroHeader">
            <h1>üß† LA PROGRAMMAZIONE DINAMICA</h1>
            <p class="subtitle">Il Viaggio nella Mente dei Geni</p>
            <p class="subtitle">"Come i Matematici hanno Scoperto il Segreto per Non Ripetere Mai lo Stesso Calcolo"</p>
            <p class="author">- Richard Bellman, 1953 -</p>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Sidebar - Chapter Navigation -->
            <aside class="chapter-sidebar">
                <h4 style="margin-bottom: 20px;">üìö Capitoli</h4>
                <ul class="chapter-list">
                    <li class="chapter-item">
                        <a class="chapter-link active" data-chapter="prologo" onclick="loadChapter('prologo')">
                            <i class="fas fa-book-open"></i>
                            <span style="margin-left: 10px;">PROLOGO</span>
                        </a>
                    </li>
                    <li class="chapter-item">
                        <a class="chapter-link" data-chapter="cap1" onclick="loadChapter('cap1')">
                            <i class="fas fa-lightbulb"></i>
                            <span style="margin-left: 10px;">La Nascita dell'Idea</span>
                        </a>
                    </li>
                    <li class="chapter-item">
                        <a class="chapter-link" data-chapter="cap2" onclick="loadChapter('cap2')">
                            <i class="fas fa-flask"></i>
                            <span style="margin-left: 10px;">L'Anatomia della DP</span>
                        </a>
                    </li>
                    <li class="chapter-item">
                        <a class="chapter-link" data-chapter="cap3" onclick="loadChapter('cap3')">
                            <i class="fas fa-brain"></i>
                            <span style="margin-left: 10px;">Il Metodo SPAZIO</span>
                        </a>
                    </li>
                    <li class="chapter-item">
                        <a class="chapter-link" data-chapter="cap4" onclick="loadChapter('cap4')">
                            <i class="fas fa-puzzle-piece"></i>
                            <span style="margin-left: 10px;">Pattern Visivi</span>
                        </a>
                    </li>
                    <li class="chapter-item">
                        <a class="chapter-link" data-chapter="cap5" onclick="loadChapter('cap5')">
                            <i class="fas fa-rocket"></i>
                            <span style="margin-left: 10px;">Dalla Teoria alla Pratica</span>
                        </a>
                    </li>
                    <li class="chapter-item">
                        <a class="chapter-link" data-chapter="cap6" onclick="loadChapter('cap6')">
                            <i class="fas fa-hat-wizard"></i>
                            <span style="margin-left: 10px;">I Trucchi dei Maestri</span>
                        </a>
                    </li>
                    <li class="chapter-item">
                        <a class="chapter-link" data-chapter="epilogo" onclick="loadChapter('epilogo')">
                            <i class="fas fa-flag-checkered"></i>
                            <span style="margin-left: 10px;">EPILOGO</span>
                        </a>
                    </li>
                </ul>

                <!-- Quick Practice -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    <h4 style="margin-bottom: 15px;">‚ö° Pratica Veloce</h4>
                    <button class="btn btn-info" style="width: 100%;" onclick="startQuickPractice()">
                        <i class="fas fa-play"></i> Problema Random
                    </button>
                </div>
            </aside>

            <!-- Content Area -->
            <main class="content-area">
                <!-- Learn Mode Content -->
                <div id="learnMode" class="mode-content">
                    <!-- Prologo -->
                    <div id="prologo" class="chapter-content active">
                        <h2>üìñ PROLOGO: LA STORIA CHE CAMBI√í TUTTO</h2>
                        
                        <section>
                            <h3>1943 - Il Problema che Ossessionava Richard Bellman</h3>
                            
                            <p>Immagina di essere un giovane matematico durante la Seconda Guerra Mondiale. Il tuo compito? Ottimizzare le traiettorie dei missili. Ogni calcolo richiede ore. E poi ti accorci di una cosa assurda...</p>
                            
                            <div class="insight-box">
                                <p><strong>"Sto calcolando la stessa maledetta cosa 100 volte!"</strong></p>
                                <p style="text-align: right;">- Richard Bellman (probabilmente)</p>
                            </div>
                            
                            <!-- Interactive Visualization -->
                            <div class="dp-visualizer">
                                <h4>üé® Visualizzazione Interattiva: Il Problema di Fibonacci</h4>
                                <div class="vis-controls">
                                    <button class="btn btn-info" onclick="startFibVisualization()">
                                        <i class="fas fa-play"></i> Avvia Animazione
                                    </button>
                                    <button class="btn btn-warning" onclick="resetFibVisualization()">
                                        <i class="fas fa-redo"></i> Reset
                                    </button>
                                    <input type="range" min="1" max="10" value="5" id="fibSlider" oninput="updateFibVisualization(this.value)">
                                    <span id="fibValue">F(5)</span>
                                </div>
                                <div class="vis-canvas" id="fibCanvas"></div>
                            </div>
                            
                            <!-- Active Recall Exercise -->
                            <div class="recall-exercise">
                                <h4 class="recall-prompt">üìù Active Recall: Spiega con parole tue</h4>
                                <p>Perch√© calcolare Fibonacci ricorsivamente √® inefficiente?</p>
                                <textarea class="recall-input" id="recall-fib" placeholder="Scrivi la tua spiegazione qui..."></textarea>
                                <button class="btn btn-info" onclick="checkRecall('fib')">
                                    <i class="fas fa-check"></i> Verifica Comprensione
                                </button>
                                <div id="recall-fib-feedback" style="margin-top: 15px; display: none;"></div>
                            </div>
                            
                            <!-- Python Interactive Exercise -->
                            <div class="python-editor-advanced">
                                <div class="editor-header">
                                    <div class="editor-title">
                                        <i class="fas fa-code"></i>
                                        Esercizio: Fibonacci Ricorsivo vs Memorizzato
                                    </div>
                                    <div class="editor-actions">
                                        <button class="btn btn-run" onclick="runPythonCode('fib-comparison')">
                                            <i class="fas fa-play"></i> Esegui
                                        </button>
                                        <button class="btn btn-test" onclick="runTests('fib-comparison')">
                                            <i class="fas fa-vial"></i> Test
                                        </button>
                                        <button class="btn btn-solution" onclick="showSolution('fib-comparison')">
                                            <i class="fas fa-lightbulb"></i> Soluzione
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-container">
                                    <div class="editor-pane">
                                        <textarea id="fib-comparison-code" class="editor-textarea">import time

def fibonacci_ricorsivo(n):
    """Implementa Fibonacci in modo ricorsivo (inefficiente)"""
    # TODO: Implementa la versione ricorsiva
    pass

def fibonacci_memo(n, memo=None):
    """Implementa Fibonacci con memoization"""
    if memo is None:
        memo = {}
    
    # TODO: Implementa la versione con memoization
    pass

# Test di performance
def test_performance():
    n = 35
    
    # Test ricorsivo
    start = time.time()
    result1 = fibonacci_ricorsivo(n)
    time1 = time.time() - start
    
    # Test memoization
    start = time.time()
    result2 = fibonacci_memo(n)
    time2 = time.time() - start
    
    print(f"Fibonacci({n}):")
    print(f"  Ricorsivo: {result1} in {time1:.4f} secondi")
    print(f"  Memoization: {result2} in {time2:.4f} secondi")
    print(f"  Speedup: {time1/time2:.0f}x pi√π veloce!")

# Esegui test
test_performance()</textarea>
                                    </div>
                                    <div class="editor-pane">
                                        <div class="test-results" id="fib-comparison-output">
                                            <div style="color: #94a3b8;">
                                                <i class="fas fa-terminal"></i> Output apparir√† qui...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Worked Example -->
                            <div class="worked-example">
                                <h4>üìö Esempio Guidato: Costruiamo la Memoization Passo-Passo</h4>
                                <div class="example-steps">
                                    <div class="example-step">
                                        <h5>Passo 1: Identifica il Problema</h5>
                                        <p>Nella versione ricorsiva, F(5) chiama F(4) e F(3), ma F(4) chiama anche F(3)...</p>
                                        <div class="ascii-art">F(5)
‚îú‚îÄ‚îÄ F(4)
‚îÇ   ‚îú‚îÄ‚îÄ F(3)
‚îÇ   ‚îî‚îÄ‚îÄ F(2)
‚îî‚îÄ‚îÄ F(3)  ‚Üê Calcolato di nuovo!
    ‚îú‚îÄ‚îÄ F(2)  ‚Üê Anche questo!
    ‚îî‚îÄ‚îÄ F(1)</div>
                                    </div>
                                    <div class="example-step step-hidden" onclick="revealStep(this)">
                                        <div class="step-reveal">Clicca per rivelare</div>
                                        <h5>Passo 2: Aggiungi una Cache</h5>
                                        <pre><code>memo = {}  # Dizionario per memorizzare risultati

def fib_memo(n):
    if n in memo:  # Gi√† calcolato?
        return memo[n]  # Restituisci subito!</code></pre>
                                    </div>
                                    <div class="example-step step-hidden" onclick="revealStep(this)">
                                        <div class="step-reveal">Clicca per rivelare</div>
                                        <h5>Passo 3: Memorizza i Risultati</h5>
                                        <pre><code>    # Calcola normalmente
    if n <= 1:
        result = n
    else:
        result = fib_memo(n-1) + fib_memo(n-2)
    
    memo[n] = result  # Salva per il futuro!
    return result</code></pre>
                                    </div>
                                </div>
                            </div>

                            <!-- Auto-explanation -->
                            <div class="explanation-box">
                                <div class="explanation-prompt">
                                    üí≠ Rifletti: Come spiegheresti la memoization a un amico?
                                </div>
                                <textarea class="explanation-field" id="explain-memo" 
                                    placeholder="Usa un'analogia o un esempio dalla vita quotidiana..."></textarea>
                                <button class="btn btn-info" onclick="saveExplanation('memo')">
                                    <i class="fas fa-save"></i> Salva Riflessione
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Capitolo 1 -->
                    <div id="cap1" class="chapter-content">
                        <h2>üèõÔ∏è CAPITOLO 1: LA NASCITA DI UN'IDEA RIVOLUZIONARIA</h2>
                        
                        <section>
                            <h3>Le 3 Domande Fondamentali che si Pose Bellman</h3>
                            
                            <div class="question-box">
                                <h4>ü§î Domanda 1: "Perch√© Ricalcolo?"</h4>
                            </div>
                            
                            <!-- Interactive Calculation Tracker -->
                            <div class="dp-visualizer">
                                <h4>Tracciatore di Calcoli Ripetuti</h4>
                                <p>Esegui fibonacci(6) e osserva quante volte viene calcolato ogni valore:</p>
                                <div class="vis-controls">
                                    <button class="btn btn-info" onclick="trackFibonacciCalls()">
                                        <i class="fas fa-calculator"></i> Traccia Calcoli
                                    </button>
                                </div>
                                <div id="callTracker" style="margin-top: 20px;">
                                    <canvas id="callChart" width="400" height="300"></canvas>
                                </div>
                            </div>

                            <div class="question-box">
                                <h4>ü§î Domanda 2: "Cosa Hanno in Comune i Sottoproblemi?"</h4>
                            </div>
                            
                            <div class="insight-box">
                                <p><strong>L'INTUIZIONE GENIALE:</strong></p>
                                <p>"Aspetta... F(3) √® SEMPRE 2, non importa se lo calcolo per F(4) o per F(5)!"</p>
                            </div>

                            <!-- Pattern Recognition Exercise -->
                            <div class="recall-exercise">
                                <h4 class="recall-prompt">üîç Riconoscimento Pattern</h4>
                                <p>Osserva questi problemi. Quali hanno sottostruttura ottima?</p>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                    <div class="practice-option" onclick="checkPattern(this, true)">
                                        <strong>Percorso Minimo in Griglia</strong>
                                        <p>Dal punto A al punto B in una griglia</p>
                                    </div>
                                    <div class="practice-option" onclick="checkPattern(this, false)">
                                        <strong>Ordinamento Array</strong>
                                        <p>Ordinare numeri dal pi√π piccolo al pi√π grande</p>
                                    </div>
                                    <div class="practice-option" onclick="checkPattern(this, true)">
                                        <strong>Zaino 0-1</strong>
                                        <p>Massimizzare valore con peso limitato</p>
                                    </div>
                                    <div class="practice-option" onclick="checkPattern(this, false)">
                                        <strong>Ricerca Binaria</strong>
                                        <p>Trovare elemento in array ordinato</p>
                                    </div>
                                </div>
                                <div id="pattern-feedback" style="margin-top: 15px; display: none;"></div>
                            </div>

                            <div class="question-box">
                                <h4>ü§î Domanda 3: "Come Posso Ricordare?"</h4>
                            </div>

                            <!-- Memory Strategies Interactive -->
                            <div class="python-editor-advanced">
                                <div class="editor-header">
                                    <div class="editor-title">
                                        <i class="fas fa-memory"></i>
                                        Esplora Strategie di Memorizzazione
                                    </div>
                                    <div class="editor-actions">
                                        <button class="btn btn-run" onclick="runPythonCode('memory-strategies')">
                                            <i class="fas fa-play"></i> Esegui
                                        </button>
                                        <button class="btn btn-test" onclick="runTests('memory-strategies')">
                                            <i class="fas fa-vial"></i> Test
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-container">
                                    <div class="editor-pane">
                                        <textarea id="memory-strategies-code" class="editor-textarea"># Confrontiamo diverse strategie di memorizzazione

# Strategia 1: Lista (array)
def fib_con_lista(n):
    if n <= 1:
        return n
    
    # Crea lista di dimensione n+1
    dp = [0] * (n + 1)
    dp[0] = 0
    dp[1] = 1
    
    # TODO: Riempi la lista
    # for i in range(2, n + 1):
    #     dp[i] = ???
    
    return dp[n]

# Strategia 2: Dizionario (hash map)
def fib_con_dizionario(n, memo={}):
    # TODO: Implementa usando dizionario
    pass

# Strategia 3: Solo ultimi 2 valori (ottimizzata)
def fib_ottimizzata(n):
    if n <= 1:
        return n
    
    # TODO: Usa solo due variabili
    # prev2, prev1 = 0, 1
    # for i in range(2, n + 1):
    #     current = ???
    #     prev2, prev1 = ???, ???
    
    pass

# Test memoria utilizzata
import sys

def test_memoria():
    n = 100
    
    # Test lista
    lista = [0] * (n + 1)
    print(f"Memoria lista: {sys.getsizeof(lista)} bytes")
    
    # Test dizionario
    dizionario = {i: i for i in range(n + 1)}
    print(f"Memoria dizionario: {sys.getsizeof(dizionario)} bytes")
    
    # Test 2 variabili
    a, b = 0, 1
    print(f"Memoria 2 variabili: {sys.getsizeof(a) + sys.getsizeof(b)} bytes")

test_memoria()</textarea>
                                    </div>
                                    <div class="editor-pane">
                                        <div class="test-results" id="memory-strategies-output">
                                            <div style="color: #94a3b8;">
                                                <i class="fas fa-terminal"></i> Output apparir√† qui...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                    <!-- Capitolo 2 -->
                    <div id="cap2" class="chapter-content">
                        <h2>üî¨ CAPITOLO 2: L'ANATOMIA DELLA PROGRAMMAZIONE DINAMICA</h2>
                        
                        <section>
                            <h3>I 4 Ingredienti Magici (Scoperti nel Tempo)</h3>
                            
                            <!-- Interactive DP Anatomy -->
                            <div class="dp-visualizer">
                                <h4>üß¨ Anatomia Interattiva della DP</h4>
                                <div class="vis-controls">
                                    <button class="btn btn-info" onclick="showDPIngredient('stati')">
                                        <i class="fas fa-map-marker"></i> Stati
                                    </button>
                                    <button class="btn btn-info" onclick="showDPIngredient('transizioni')">
                                        <i class="fas fa-arrows-alt"></i> Transizioni
                                    </button>
                                    <button class="btn btn-info" onclick="showDPIngredient('base')">
                                        <i class="fas fa-anchor"></i> Casi Base
                                    </button>
                                    <button class="btn btn-info" onclick="showDPIngredient('ordine')">
                                        <i class="fas fa-sort"></i> Ordine
                                    </button>
                                </div>
                                <div id="dpAnatomyDisplay" style="margin-top: 20px; min-height: 200px;">
                                    <p style="text-align: center; color: #94a3b8;">
                                        Clicca su un ingrediente per esplorarlo
                                    </p>
                                </div>
                            </div>

                            <!-- States Deep Dive -->
                            <div class="insight-box">
                                <h4>üß™ Ingrediente 1: Stati (1950s)</h4>
                                <p><em>"Cosa devo sapere per prendere una decisione?"</em></p>
                            </div>

                            <!-- State Design Exercise -->
                            <div class="recall-exercise">
                                <h4 class="recall-prompt">üéØ Progetta gli Stati</h4>
                                <p>Per ogni problema, identifica quali informazioni deve contenere lo stato:</p>
                                
                                <div style="margin-top: 20px;">
                                    <div style="margin-bottom: 20px;">
                                        <strong>Problema 1: Sottosequenza crescente pi√π lunga</strong>
                                        <input type="text" class="recall-input" style="min-height: 50px; padding: 10px;" 
                                            placeholder="Lo stato deve contenere..." 
                                            id="state-design-1">
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <strong>Problema 2: Percorsi in griglia con ostacoli</strong>
                                        <input type="text" class="recall-input" style="min-height: 50px; padding: 10px;" 
                                            placeholder="Lo stato deve contenere..." 
                                            id="state-design-2">
                                    </div>
                                    <button class="btn btn-info" onclick="checkStateDesign()">
                                        <i class="fas fa-check"></i> Verifica Design
                                    </button>
                                    <div id="state-design-feedback" style="margin-top: 15px; display: none;"></div>
                                </div>
                            </div>

                            <!-- Interactive State Transition Builder -->
                            <div class="python-editor-advanced">
                                <div class="editor-header">
                                    <div class="editor-title">
                                        <i class="fas fa-project-diagram"></i>
                                        Costruttore di Transizioni di Stato
                                    </div>
                                    <div class="editor-actions">
                                        <button class="btn btn-run" onclick="runPythonCode('state-transitions')">
                                            <i class="fas fa-play"></i> Esegui
                                        </button>
                                        <button class="btn btn-info" onclick="visualizeStateTransitions()">
                                            <i class="fas fa-eye"></i> Visualizza
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-container">
                                    <div class="editor-pane">
                                        <textarea id="state-transitions-code" class="editor-textarea"># Esplora diverse transizioni di stato

# Esempio 1: Monete - Cambio minimo
def cambio_monete(importo, monete):
    """
    Stato: dp[i] = numero minimo di monete per fare importo i
    Transizione: dp[i] = min(dp[i-moneta] + 1) per ogni moneta
    """
    dp = [float('inf')] * (importo + 1)
    dp[0] = 0  # Caso base
    
    # TODO: Implementa le transizioni
    # for i in range(1, importo + 1):
    #     for moneta in monete:
    #         if i >= moneta:
    #             dp[i] = ???
    
    return dp[importo] if dp[importo] != float('inf') else -1

# Esempio 2: String Edit Distance
def edit_distance(s1, s2):
    """
    Stato: dp[i][j] = distanza tra s1[:i] e s2[:j]
    Transizioni: insert, delete, replace
    """
    m, n = len(s1), len(s2)
    dp = [[0] * (n + 1) for _ in range(m + 1)]
    
    # TODO: Casi base
    # for i in range(m + 1):
    #     dp[i][0] = ???
    # for j in range(n + 1):
    #     dp[0][j] = ???
    
    # TODO: Transizioni
    # for i in range(1, m + 1):
    #     for j in range(1, n + 1):
    #         if s1[i-1] == s2[j-1]:
    #             dp[i][j] = ???
    #         else:
    #             dp[i][j] = ???
    
    return dp[m][n]

# Test
print("Cambio monete (11, [1,5,6]): ", cambio_monete(11, [1, 5, 6]))
print("Edit distance ('kitten', 'sitting'): ", edit_distance('kitten', 'sitting'))</textarea>
                                    </div>
                                    <div class="editor-pane">
                                        <div class="test-results" id="state-transitions-output">
                                            <div style="color: #94a3b8;">
                                                <i class="fas fa-terminal"></i> Output apparir√† qui...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Matters Visualization -->
                            <div class="dp-visualizer">
                                <h4>üéØ L'Ordine √® Fondamentale</h4>
                                <p>Osserva come l'ordine di calcolo influenza il risultato:</p>
                                <div class="vis-controls">
                                    <button class="btn btn-info" onclick="showOrder('bottomup')">
                                        <i class="fas fa-arrow-up"></i> Bottom-Up
                                    </button>
                                    <button class="btn btn-info" onclick="showOrder('topdown')">
                                        <i class="fas fa-arrow-down"></i> Top-Down
                                    </button>
                                    <button class="btn btn-danger" onclick="showOrder('random')">
                                        <i class="fas fa-random"></i> Ordine Casuale (Errore!)
                                    </button>
                                </div>
                                <div id="orderVisualization" style="margin-top: 20px;">
                                    <svg id="orderSvg" width="600" height="400"></svg>
                                </div>
                            </div>
                        </section>
                    </div>

                    <!-- Altri capitoli seguono lo stesso pattern con componenti interattivi avanzati -->
                    <!-- Per brevit√†, mostro solo la struttura base -->

                    <div id="cap3" class="chapter-content">
                        <h2>üéØ CAPITOLO 3: L'ALGORITMO MENTALE DEFINITIVO</h2>
                        <!-- Contenuto del capitolo 3 con tutti i componenti interattivi -->
                    </div>

                    <div id="cap4" class="chapter-content">
                        <h2>üé® CAPITOLO 4: PATTERN VISIVI - Riconoscere al Volo</h2>
                        <!-- Contenuto del capitolo 4 con pattern recognition interattivo -->
                    </div>

                    <div id="cap5" class="chapter-content">
                        <h2>üöÄ CAPITOLO 5: DALLA TEORIA ALLA PRATICA</h2>
                        <!-- Contenuto del capitolo 5 con case study completi -->
                    </div>

                    <div id="cap6" class="chapter-content">
                        <h2>üéì CAPITOLO 6: I TRUCCHI DEI MAESTRI</h2>
                        <!-- Contenuto del capitolo 6 con tecniche avanzate -->
                    </div>

                    <div id="epilogo" class="chapter-content">
                        <h2>üìö EPILOGO: IL TUO VIAGGIO CONTINUA</h2>
                        <!-- Contenuto dell'epilogo con roadmap personalizzata -->
                    </div>
                </div>

                <!-- Practice Mode Content -->
                <div id="practiceMode" class="mode-content" style="display: none;">
                    <h2>üèãÔ∏è Modalit√† Pratica</h2>
                    
                    <div class="practice-mode-selector">
                        <h3>Scegli il tipo di pratica:</h3>
                        <div class="practice-options">
                            <div class="practice-option" onclick="startPractice('focused')">
                                <i class="fas fa-bullseye fa-2x"></i>
                                <h4>Pratica Focalizzata</h4>
                                <p>Esercizi su un singolo pattern DP</p>
                            </div>
                            <div class="practice-option" onclick="startPractice('mixed')">
                                <i class="fas fa-random fa-2x"></i>
                                <h4>Pratica Mista</h4>
                                <p>Mix di problemi da tutti i capitoli</p>
                            </div>
                            <div class="practice-option" onclick="startPractice('adaptive')">
                                <i class="fas fa-brain fa-2x"></i>
                                <h4>Pratica Adattiva</h4>
                                <p>Difficolt√† basata sulle tue performance</p>
                            </div>
                        </div>
                    </div>

                    <div id="practiceContent" style="display: none;">
                        <!-- Dynamic practice content loaded here -->
                    </div>
                </div>

                <!-- Review Mode Content -->
                <div id="reviewMode" class="mode-content" style="display: none;">
                    <h2>üìö Modalit√† Ripasso</h2>
                    
                    <div class="metacognitive-dashboard">
                        <div class="meta-card">
                            <h3>üìä Heatmap dei Progressi</h3>
                            <p>Ultimi 30 giorni di attivit√†</p>
                            <div class="heatmap" id="progressHeatmap"></div>
                        </div>
                        
                        <div class="meta-card">
                            <h3>üéØ Aree di Forza</h3>
                            <canvas id="strengthChart" width="300" height="200"></canvas>
                        </div>
                        
                        <div class="meta-card">
                            <h3>‚ö†Ô∏è Aree da Migliorare</h3>
                            <div id="weaknessAreas"></div>
                        </div>
                        
                        <div class="meta-card">
                            <h3>üìà Trend di Apprendimento</h3>
                            <canvas id="learningTrend" width="300" height="200"></canvas>
                        </div>
                    </div>

                    <div class="spaced-repetition-card" style="margin-top: 30px;">
                        <h3>üîÑ Coda di Ripasso Intelligente</h3>
                        <p>Basata sull'algoritmo di spaced repetition</p>
                        <div id="reviewQueue" style="margin-top: 20px;">
                            <!-- Dynamic review items -->
                        </div>
                        <button class="btn btn-info" style="width: 100%; margin-top: 15px;" onclick="startSmartReview()">
                            <i class="fas fa-play"></i> Inizia Sessione di Ripasso
                        </button>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <!-- Spaced Repetition Card -->
                <div class="spaced-repetition-card">
                    <h3>üß† Ripasso Intelligente</h3>
                    <div class="review-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="dueToday">0</div>
                            <div class="stat-label">Da ripassare oggi</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="streak">0</div>
                            <div class="stat-label">Giorni consecutivi</div>
                        </div>
                    </div>
                    <div class="review-queue">
                        <h4 style="margin-top: 20px; margin-bottom: 10px;">Prossimi ripassi:</h4>
                        <div id="upcomingReviews">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                    <button class="btn btn-success" style="width: 100%; margin-top: 15px;" onclick="startReview()">
                        <i class="fas fa-redo"></i> Inizia Ripasso
                    </button>
                </div>

                <!-- Progress Overview -->
                <div class="spaced-repetition-card">
                    <h3>üìä I Tuoi Progressi</h3>
                    <div style="margin-top: 20px;">
                        <div class="difficulty-indicator">
                            <span>Livello Attuale:</span>
                            <div class="difficulty-bar">
                                <div class="difficulty-fill" id="currentLevel" style="width: 30%"></div>
                            </div>
                            <small id="levelLabel">Principiante</small>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <strong>Statistiche:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px;">
                                <li>Problemi risolti: <strong id="problemsSolved">0</strong></li>
                                <li>Tasso successo: <strong id="successRate">0%</strong></li>
                                <li>Tempo medio: <strong id="avgTime">0s</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="spaced-repetition-card">
                    <h3>‚ö° Azioni Rapide</h3>
                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                        <button class="btn btn-info" onclick="showAnnotations()">
                            <i class="fas fa-sticky-note"></i> Le Mie Note
                        </button>
                        <button class="btn btn-warning" onclick="showMistakes()">
                            <i class="fas fa-exclamation-triangle"></i> Errori Comuni
                        </button>
                        <button class="btn btn-success" onclick="exportProgress()">
                            <i class="fas fa-download"></i> Esporta Progressi
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Focus Mode Toggle -->
    <div class="focus-mode-toggle" onclick="toggleFocusMode()" title="Modalit√† Focus">
        <i class="fas fa-compress" id="focusIcon"></i>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="shortcuts-modal" id="shortcutsModal">
        <h3>‚å®Ô∏è Scorciatoie da Tastiera</h3>
        <div style="margin-top: 20px;">
            <div class="shortcut-item">
                <span>Navigazione capitoli</span>
                <span class="shortcut-key">‚Üê ‚Üí</span>
            </div>
            <div class="shortcut-item">
                <span>Esegui codice</span>
                <span class="shortcut-key">Ctrl + Enter</span>
            </div>
            <div class="shortcut-item">
                <span>Modalit√† focus</span>
                <span class="shortcut-key">F</span>
            </div>
            <div class="shortcut-item">
                <span>Cambio tema</span>
                <span class="shortcut-key">T</span>
            </div>
            <div class="shortcut-item">
                <span>Ricerca</span>
                <span class="shortcut-key">Ctrl + K</span>
            </div>
            <div class="shortcut-item">
                <span>Aiuto</span>
                <span class="shortcut-key">?</span>
            </div>
        </div>
        <button class="btn btn-info" style="margin-top: 20px; width: 100%;" onclick="closeShortcuts()">
            Chiudi
        </button>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Scripts -->
    <script>
        // Global State Management
        const appState = {
            currentChapter: 'prologo',
            currentMode: 'learn',
            completedChapters: new Set(),
            completedExercises: new Set(),
            spacedRepetitionData: {},
            annotations: {},
            mistakes: [],
            userLevel: 1,
            pythonReady: false,
            pyodide: null,
            theme: localStorage.getItem('theme') || 'light',
            focusMode: false,
            adaptiveDifficulty: 1,
            sessionStartTime: Date.now(),
            exerciseStats: {
                attempted: 0,
                solved: 0,
                totalTime: 0
            }
        };

        // Initialize Pyodide
        async function initializePython() {
            try {
                appState.pyodide = await loadPyodide();
                await appState.pyodide.loadPackage(['numpy', 'matplotlib']);
                appState.pythonReady = true;
                hideLoading();
                showNotification('Python environment ready!', 'success');
            } catch (error) {
                console.error('Failed to load Pyodide:', error);
                hideLoading();
                showNotification('Python initialization failed. Some features may not work.', 'error');
            }
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', async () => {
            // Load saved state
            loadState();
            
            // Apply theme
            document.documentElement.setAttribute('data-theme', appState.theme);
            updateThemeIcon();
            
            // Initialize Python
            await initializePython();
            
            // Initialize visualizations
            initializeVisualizations();
            
            // Setup keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Initialize spaced repetition
            initializeSpacedRepetition();
            
            // Update UI
            updateProgressDisplay();
            
            // Show welcome message for new users
            if (appState.completedChapters.size === 0) {
                setTimeout(() => {
                    showNotification('üëã Benvenuto! Inizia dal PROLOGO per scoprire la magia della DP!', 'info');
                }, 1000);
            }
        });

        // Chapter Management
        function loadChapter(chapterId) {
            // Update state
            appState.currentChapter = chapterId;
            
            // Update UI
            document.querySelectorAll('.chapter-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(chapterId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.chapter-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.chapter === chapterId) {
                    link.classList.add('active');
                }
            });
            
            // Mark as completed after reading time
            setTimeout(() => {
                if (!appState.completedChapters.has(chapterId)) {
                    appState.completedChapters.add(chapterId);
                    document.querySelector(`[data-chapter="${chapterId}"]`).classList.add('completed');
                    updateProgressDisplay();
                    saveState();
                    
                    // Add to spaced repetition
                    addToSpacedRepetition(chapterId, 'chapter');
                    
                    // Achievement check
                    checkAchievements();
                }
            }, 30000); // 30 seconds reading time
            
            // Save state
            saveState();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Mode Management
        function setMode(mode) {
            appState.currentMode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide content
            document.querySelectorAll('.mode-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`${mode}Mode`).style.display = 'block';
            
            // Mode-specific initialization
            if (mode === 'practice') {
                initializePracticeMode();
            } else if (mode === 'review') {
                initializeReviewMode();
            }
            
            // Update hero visibility
            document.getElementById('heroHeader').style.display = mode === 'learn' ? 'block' : 'none';
        }

        // Python Code Execution
        async function runPythonCode(editorId) {
            if (!appState.pythonReady) {
                showNotification('Python environment not ready yet', 'error');
                return;
            }
            
            const code = document.getElementById(`${editorId}-code`).value;
            const outputElement = document.getElementById(`${editorId}-output`);
            
            outputElement.innerHTML = '<div style="color: #10b981;">Running...</div>';
            
            try {
                // Redirect stdout
                await appState.pyodide.runPython(`
                    import sys
                    from io import StringIO
                    sys.stdout = StringIO()
                `);
                
                // Run user code
                await appState.pyodide.runPython(code);
                
                // Get output
                const output = await appState.pyodide.runPython(`sys.stdout.getvalue()`);
                
                outputElement.innerHTML = `<div style="color: #10b981;">‚úì Output:</div><pre>${output}</pre>`;
                
                // Track exercise completion
                if (!appState.completedExercises.has(editorId)) {
                    appState.completedExercises.add(editorId);
                    updateProgressDisplay();
                    saveState();
                    addToSpacedRepetition(editorId, 'exercise');
                }
                
                // Update stats
                appState.exerciseStats.attempted++;
                appState.exerciseStats.solved++;
                updateStats();
                
            } catch (error) {
                outputElement.innerHTML = `<div style="color: #ef4444;">‚úó Error:</div><pre style="color: #ef4444;">${error}</pre>`;
                
                // Track mistake
                trackMistake(editorId, code, error.toString());
            }
        }

        // Test Runner
        async function runTests(editorId) {
            const code = document.getElementById(`${editorId}-code`).value;
            const outputElement = document.getElementById(`${editorId}-output`);
            
            // Define tests based on exercise
            const tests = getTestsForExercise(editorId);
            
            outputElement.innerHTML = '<div style="color: #3b82f6;">Running tests...</div>';
            
            let results = [];
            
            for (let test of tests) {
                try {
                    // Run test
                    const result = await runSingleTest(code, test);
                    results.push(result);
                } catch (error) {
                    results.push({
                        name: test.name,
                        passed: false,
                        error: error.toString()
                    });
                }
            }
            
            // Display results
            displayTestResults(outputElement, results);
            
            // Check if all passed
            const allPassed = results.every(r => r.passed);
            if (allPassed) {
                showNotification('üéâ Tutti i test sono passati!', 'success');
                appState.exerciseStats.solved++;
                
                // Adaptive difficulty
                adjustDifficulty(true);
            } else {
                adjustDifficulty(false);
            }
        }

        // Solution Viewer with Diff
        function showSolution(editorId) {
            const userCode = document.getElementById(`${editorId}-code`).value;
            const solution = getSolutionForExercise(editorId);
            
            // Create diff view
            const diffHtml = createCodeDiff(userCode, solution);
            
            // Show in modal or inline
            const outputElement = document.getElementById(`${editorId}-output`);
            outputElement.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong style="color: #f59e0b;">üìù Confronto con la Soluzione:</strong>
                </div>
                <div class="diff-viewer">${diffHtml}</div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-info" onclick="copySolution('${editorId}')">
                        <i class="fas fa-copy"></i> Copia Soluzione
                    </button>
                </div>
            `;
        }

        // Visualization Functions
        function startFibVisualization() {
            const canvas = document.getElementById('fibCanvas');
            canvas.innerHTML = ''; // Clear previous
            
            // Create D3 visualization
            const width = 600;
            const height = 400;
            
            const svg = d3.select('#fibCanvas')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Animate fibonacci tree
            animateFibonacciTree(svg, 5);
        }

        function animateFibonacciTree(svg, n) {
            // Tree data structure
            const treeData = buildFibTree(n);
            
            // Create tree layout
            const treeLayout = d3.tree()
                .size([580, 360]);
            
            const root = d3.hierarchy(treeData);
            treeLayout(root);
            
            // Draw links
            svg.selectAll('.link')
                .data(root.links())
                .enter()
                .append('line')
                .attr('class', 'link')
                .attr('x1', d => d.source.x + 10)
                .attr('y1', d => d.source.y + 20)
                .attr('x2', d => d.target.x + 10)
                .attr('y2', d => d.target.y + 20)
                .attr('stroke', '#94a3b8')
                .attr('stroke-width', 2)
                .style('opacity', 0)
                .transition()
                .duration(1000)
                .style('opacity', 1);
            
            // Draw nodes
            const nodes = svg.selectAll('.node')
                .data(root.descendants())
                .enter()
                .append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x + 10}, ${d.y + 20})`);
            
            nodes.append('circle')
                .attr('r', 25)
                .attr('fill', d => d.data.duplicate ? '#ef4444' : '#4f46e5')
                .style('opacity', 0)
                .transition()
                .duration(1000)
                .delay((d, i) => i * 100)
                .style('opacity', 1);
            
            nodes.append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', '0.3em')
                .attr('fill', 'white')
                .style('font-weight', 'bold')
                .text(d => `F(${d.data.n})`)
                .style('opacity', 0)
                .transition()
                .duration(1000)
                .delay((d, i) => i * 100)
                .style('opacity', 1);
            
            // Highlight duplicates
            setTimeout(() => {
                nodes.filter(d => d.data.duplicate)
                    .select('circle')
                    .transition()
                    .duration(500)
                    .attr('r', 30)
                    .transition()
                    .duration(500)
                    .attr('r', 25);
            }, 2000);
        }

        function buildFibTree(n, seen = new Set()) {
            const key = `F(${n})`;
            const duplicate = seen.has(key);
            seen.add(key);
            
            if (n <= 1) {
                return { n, duplicate, children: [] };
            }
            
            return {
                n,
                duplicate,
                children: [
                    buildFibTree(n - 1, seen),
                    buildFibTree(n - 2, seen)
                ]
            };
        }

        // Active Recall Verification
        function checkRecall(topic) {
            const input = document.getElementById(`recall-${topic}`).value;
            const feedback = document.getElementById(`recall-${topic}-feedback`);
            
            if (input.trim().length < 50) {
                feedback.innerHTML = '<div style="color: #f59e0b;">üìù Prova a scrivere una spiegazione pi√π dettagliata (almeno 50 caratteri)</div>';
                feedback.style.display = 'block';
                return;
            }
            
            // Simple keyword analysis
            const keywords = getKeywordsForTopic(topic);
            const matchedKeywords = keywords.filter(kw => 
                input.toLowerCase().includes(kw.toLowerCase())
            );
            
            const score = matchedKeywords.length / keywords.length;
            
            if (score >= 0.7) {
                feedback.innerHTML = `
                    <div style="color: #10b981;">
                        ‚úÖ Ottima spiegazione! Hai menzionato concetti chiave come: 
                        ${matchedKeywords.join(', ')}
                    </div>
                `;
            } else if (score >= 0.4) {
                feedback.innerHTML = `
                    <div style="color: #f59e0b;">
                        üìù Buon inizio! Considera anche di menzionare: 
                        ${keywords.filter(kw => !matchedKeywords.includes(kw)).slice(0, 2).join(', ')}
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div style="color: #ef4444;">
                        ‚ùå Riprova includendo concetti come: 
                        ${keywords.slice(0, 3).join(', ')}
                    </div>
                `;
            }
            
            feedback.style.display = 'block';
            
            // Save explanation
            saveExplanation(topic, input);
        }

        function getKeywordsForTopic(topic) {
            const keywords = {
                'fib': ['ripetizione', 'sottoproblemi', 'calcolo', 'inefficiente', 'ridondante'],
                'memo': ['cache', 'memorizzare', 'riutilizzare', 'veloce', 'ottimizzazione']
            };
            return keywords[topic] || [];
        }

        // Spaced Repetition System
        function initializeSpacedRepetition() {
            // Load saved data
            const saved = localStorage.getItem('spacedRepetitionData');
            if (saved) {
                appState.spacedRepetitionData = JSON.parse(saved);
            }
            
            // Update UI
            updateSpacedRepetitionDisplay();
        }

        function addToSpacedRepetition(itemId, type) {
            const now = Date.now();
            const item = {
                id: itemId,
                type: type,
                lastReview: now,
                nextReview: now + 24 * 60 * 60 * 1000, // 1 day
                interval: 1,
                easeFactor: 2.5,
                repetitions: 0
            };
            
            appState.spacedRepetitionData[itemId] = item;
            saveSpacedRepetitionData();
            updateSpacedRepetitionDisplay();
        }

        function updateSpacedRepetitionDisplay() {
            const now = Date.now();
            const due = Object.values(appState.spacedRepetitionData)
                .filter(item => item.nextReview <= now).length;
            
            document.getElementById('dueToday').textContent = due;
            
            // Update upcoming reviews
            const upcoming = Object.values(appState.spacedRepetitionData)
                .filter(item => item.nextReview > now)
                .sort((a, b) => a.nextReview - b.nextReview)
                .slice(0, 3);
            
            const upcomingHtml = upcoming.map(item => `
                <div class="review-item">
                    <i class="fas fa-clock"></i>
                    ${item.id} - ${formatTimeUntil(item.nextReview)}
                </div>
            `).join('');
            
            document.getElementById('upcomingReviews').innerHTML = upcomingHtml || 
                '<p style="color: #94a3b8;">Nessun ripasso programmato</p>';
        }

        function formatTimeUntil(timestamp) {
            const diff = timestamp - Date.now();
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `tra ${days} giorni`;
            if (hours > 0) return `tra ${hours} ore`;
            return 'presto';
        }

        // Practice Mode
        function startPractice(type) {
            const content = document.getElementById('practiceContent');
            content.style.display = 'block';
            
            if (type === 'mixed') {
                loadMixedPractice();
            } else if (type === 'focused') {
                loadFocusedPractice();
            } else if (type === 'adaptive') {
                loadAdaptivePractice();
            }
        }

        function loadMixedPractice() {
            // Get problems from all chapters
            const problems = getAllProblems();
            const shuffled = shuffleArray(problems);
            
            displayPracticeProblems(shuffled.slice(0, 5));
        }

        function loadAdaptivePractice() {
            // Get problems based on user level
            const problems = getProblemsForLevel(appState.adaptiveDifficulty);
            displayPracticeProblems(problems);
        }

        // Metacognitive Dashboard
        function initializeReviewMode() {
            // Generate heatmap
            generateProgressHeatmap();
            
            // Generate strength chart
            generateStrengthChart();
            
            // Generate learning trend
            generateLearningTrend();
            
            // Identify weaknesses
            identifyWeaknesses();
        }

        function generateProgressHeatmap() {
            const heatmap = document.getElementById('progressHeatmap');
            const data = generateHeatmapData();
            
            heatmap.innerHTML = data.map((value, index) => {
                const intensity = value / 10;
                const color = `rgba(79, 70, 229, ${intensity})`;
                const date = new Date();
                date.setDate(date.getDate() - (29 - index));
                
                return `<div class="heatmap-cell" 
                    style="background: ${color}" 
                    title="${date.toLocaleDateString()}: ${value} attivit√†"
                    onclick="showDayDetails('${date.toISOString()}')"></div>`;
            }).join('');
        }

        function generateHeatmapData() {
            // Simulate activity data
            return Array.from({ length: 30 }, () => Math.floor(Math.random() * 10));
        }

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                    type === 'error' ? 'times-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function toggleTheme() {
            appState.theme = appState.theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', appState.theme);
            updateThemeIcon();
            localStorage.setItem('theme', appState.theme);
        }

        function updateThemeIcon() {
            const icon = document.getElementById('themeIcon');
            icon.className = appState.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }

        function toggleFocusMode() {
            appState.focusMode = !appState.focusMode;
            document.body.classList.toggle('focus-mode');
            
            const icon = document.getElementById('focusIcon');
            icon.className = appState.focusMode ? 'fas fa-expand' : 'fas fa-compress';
        }

        function showShortcuts() {
            document.getElementById('shortcutsModal').classList.add('show');
        }

        function closeShortcuts() {
            document.getElementById('shortcutsModal').classList.remove('show');
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Navigation
                if (e.key === 'ArrowLeft') {
                    navigateChapter(-1);
                } else if (e.key === 'ArrowRight') {
                    navigateChapter(1);
                }
                
                // Run code
                else if (e.ctrlKey && e.key === 'Enter') {
                    const activeEditor = document.querySelector('.editor-textarea:focus');
                    if (activeEditor) {
                        const editorId = activeEditor.id.replace('-code', '');
                        runPythonCode(editorId);
                    }
                }
                
                // Focus mode
                else if (e.key === 'f' && !e.ctrlKey && !e.target.matches('input, textarea')) {
                    toggleFocusMode();
                }
                
                // Theme
                else if (e.key === 't' && !e.ctrlKey && !e.target.matches('input, textarea')) {
                    toggleTheme();
                }
                
                // Help
                else if (e.key === '?' && !e.target.matches('input, textarea')) {
                    showShortcuts();
                }
            });
        }

        function navigateChapter(direction) {
            const chapters = ['prologo', 'cap1', 'cap2', 'cap3', 'cap4', 'cap5', 'cap6', 'epilogo'];
            const currentIndex = chapters.indexOf(appState.currentChapter);
            const newIndex = Math.max(0, Math.min(chapters.length - 1, currentIndex + direction));
            
            if (newIndex !== currentIndex) {
                loadChapter(chapters[newIndex]);
            }
        }

        // State Management
        function saveState() {
            const state = {
                completedChapters: Array.from(appState.completedChapters),
                completedExercises: Array.from(appState.completedExercises),
                annotations: appState.annotations,
                mistakes: appState.mistakes,
                userLevel: appState.userLevel,
                exerciseStats: appState.exerciseStats,
                lastAccess: Date.now()
            };
            
            localStorage.setItem('dpLearningState', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('dpLearningState');
            if (saved) {
                const state = JSON.parse(saved);
                appState.completedChapters = new Set(state.completedChapters || []);
                appState.completedExercises = new Set(state.completedExercises || []);
                appState.annotations = state.annotations || {};
                appState.mistakes = state.mistakes || [];
                appState.userLevel = state.userLevel || 1;
                appState.exerciseStats = state.exerciseStats || appState.exerciseStats;
            }
        }

        function saveSpacedRepetitionData() {
            localStorage.setItem('spacedRepetitionData', 
                JSON.stringify(appState.spacedRepetitionData));
        }

        function updateProgressDisplay() {
            const chapters = 8;
            const exercises = 20; // Total exercises
            
            const chaptersCompleted = appState.completedChapters.size;
            const exercisesCompleted = appState.completedExercises.size;
            
            // Update stats
            document.getElementById('problemsSolved').textContent = exercisesCompleted;
            document.getElementById('successRate').textContent = 
                appState.exerciseStats.attempted > 0 
                    ? Math.round((appState.exerciseStats.solved / appState.exerciseStats.attempted) * 100) + '%'
                    : '0%';
            
            // Update level
            const level = Math.floor((chaptersCompleted + exercisesCompleted) / 5) + 1;
            appState.userLevel = level;
            updateLevelDisplay();
        }

        function updateLevelDisplay() {
            const levels = ['Principiante', 'Intermedio', 'Avanzato', 'Esperto', 'Master'];
            const levelIndex = Math.min(appState.userLevel - 1, levels.length - 1);
            
            document.getElementById('currentLevel').style.width = `${(levelIndex + 1) * 20}%`;
            document.getElementById('levelLabel').textContent = levels[levelIndex];
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Helper functions for exercises and solutions
        function getTestsForExercise(exerciseId) {
            const tests = {
                'fib-comparison': [
                    { name: 'Test base F(0)', input: 0, expected: 0 },
                    { name: 'Test base F(1)', input: 1, expected: 1 },
                    { name: 'Test F(10)', input: 10, expected: 55 },
                    { name: 'Test F(20)', input: 20, expected: 6765 }
                ],
                'memory-strategies': [
                    { name: 'Test efficienza memoria', type: 'memory' },
                    { name: 'Test correttezza risultati', type: 'correctness' }
                ]
            };
            
            return tests[exerciseId] || [];
        }

        function getSolutionForExercise(exerciseId) {
            const solutions = {
                'fib-comparison': `def fibonacci_ricorsivo(n):
    if n <= 1:
        return n
    return fibonacci_ricorsivo(n-1) + fibonacci_ricorsivo(n-2)

def fibonacci_memo(n, memo=None):
    if memo is None:
        memo = {}
    
    if n in memo:
        return memo[n]
    
    if n <= 1:
        result = n
    else:
        result = fibonacci_memo(n-1, memo) + fibonacci_memo(n-2, memo)
    
    memo[n] = result
    return result`,
                
                'memory-strategies': `def fib_con_lista(n):
    if n <= 1:
        return n
    
    dp = [0] * (n + 1)
    dp[0] = 0
    dp[1] = 1
    
    for i in range(2, n + 1):
        dp[i] = dp[i-1] + dp[i-2]
    
    return dp[n]

def fib_con_dizionario(n, memo={}):
    if n in memo:
        return memo[n]
    if n <= 1:
        return n
    memo[n] = fib_con_dizionario(n-1, memo) + fib_con_dizionario(n-2, memo)
    return memo[n]

def fib_ottimizzata(n):
    if n <= 1:
        return n
    
    prev2, prev1 = 0, 1
    for i in range(2, n + 1):
        current = prev1 + prev2
        prev2, prev1 = prev1, current
    
    return prev1`
            };
            
            return solutions[exerciseId] || '';
        }

        function createCodeDiff(userCode, solution) {
            const userLines = userCode.split('\n');
            const solutionLines = solution.split('\n');
            
            // Simple diff visualization
            let diffHtml = '';
            const maxLines = Math.max(userLines.length, solutionLines.length);
            
            for (let i = 0; i < maxLines; i++) {
                const userLine = userLines[i] || '';
                const solutionLine = solutionLines[i] || '';
                
                if (userLine === solutionLine) {
                    diffHtml += `<div class="diff-line diff-unchanged">${escapeHtml(userLine)}</div>`;
                } else {
                    if (userLine) {
                        diffHtml += `<div class="diff-line diff-removed">- ${escapeHtml(userLine)}</div>`;
                    }
                    if (solutionLine) {
                        diffHtml += `<div class="diff-line diff-added">+ ${escapeHtml(solutionLine)}</div>`;
                    }
                }
            }
            
            return diffHtml;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Problem and difficulty management
        function adjustDifficulty(success) {
            if (success) {
                appState.adaptiveDifficulty = Math.min(5, appState.adaptiveDifficulty + 0.2);
            } else {
                appState.adaptiveDifficulty = Math.max(1, appState.adaptiveDifficulty - 0.1);
            }
        }

        function getAllProblems() {
            // Return array of all problems from all chapters
            return [
                { id: 'fib', chapter: 'prologo', difficulty: 1, title: 'Fibonacci Base' },
                { id: 'stairs', chapter: 'cap1', difficulty: 2, title: 'Climbing Stairs' },
                { id: 'coins', chapter: 'cap2', difficulty: 3, title: 'Coin Change' },
                // ... more problems
            ];
        }

        function getProblemsForLevel(level) {
            const allProblems = getAllProblems();
            return allProblems.filter(p => 
                p.difficulty >= level - 0.5 && p.difficulty <= level + 0.5
            );
        }

        // Add more implementation functions as needed...
    </script>
</body>
</html>
